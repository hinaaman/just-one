"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.serveStatic = void 0;
const fs_1 = require("fs");
const filepath_1 = require("hono/utils/filepath");
const mime_1 = require("hono/utils/mime");
const serveStatic = (options = { root: '' }) => {
    return async (c, next) => {
        // Do nothing if Response is already set
        if (c.finalized) {
            await next();
        }
        const url = new URL(c.req.url);
        const filename = options.path ?? decodeURI(url.pathname);
        let path = (0, filepath_1.getFilePath)({
            filename: options.rewriteRequestPath ? options.rewriteRequestPath(filename) : filename,
            root: options.root,
            defaultDocument: options.index ?? 'index.html',
        });
        path = `./${path}`;
        if ((0, fs_1.existsSync)(path)) {
            const content = (0, fs_1.readFileSync)(path);
            if (content) {
                const mimeType = (0, mime_1.getMimeType)(path);
                if (mimeType) {
                    c.header('Content-Type', mimeType);
                }
                // Return Response object
                return c.body(content);
            }
        }
        console.warn(`Static file: ${path} is not found`);
        await next();
        return;
    };
};
exports.serveStatic = serveStatic;
